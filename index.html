<!DOCTYPE html>
<html>
<head>
  <title>Smart Street Light – History Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    canvas { margin-bottom: 40px; }
  </style>
</head>

<body>

<h1>Smart Street Light – Historical Dashboard</h1>

<!-- ================= ZONE 1 ================= -->
<h2>Zone 1</h2>
<canvas id="z1Power"></canvas>
<canvas id="z1Current"></canvas>
<canvas id="z1Ldr"></canvas>
<canvas id="z1Brightness"></canvas>

<!-- ================= ZONE 2 ================= -->
<h2>Zone 2</h2>
<canvas id="z2Power"></canvas>
<canvas id="z2Current"></canvas>
<canvas id="z2Ldr"></canvas>
<canvas id="z2Brightness"></canvas>

<!-- ================= ZONE 3 ================= -->
<h2>Zone 3</h2>
<canvas id="z3Power"></canvas>
<canvas id="z3Current"></canvas>
<canvas id="z3Ldr"></canvas>
<canvas id="z3Brightness"></canvas>

<!-- ================= ZONE 4 ================= -->
<h2>Zone 4</h2>
<canvas id="z4Power"></canvas>
<canvas id="z4Current"></canvas>
<canvas id="z4Ldr"></canvas>
<canvas id="z4Brightness"></canvas>

<script>
function loadZone(zone, idx) {
  fetch(`https://idp-eg8-default-rtdb.asia-southeast1.firebasedatabase.app/SmartStreetLight/${zone}/history.json`)
    .then(res => res.json())
    .then(history => {

      if (!history) return;

      const labels = [];
      const power = [];
      const current = [];
      const ldr = [];
      const brightness = [];

      for (const ts in history) {
        labels.push(new Date(parseInt(ts)).toLocaleTimeString());
        power.push(history[ts].power ?? 0);
        current.push(history[ts].current ?? 0);
        ldr.push(history[ts].ldr ?? 0);
        brightness.push(history[ts].brightness_level ?? 0);
      }

      function makeChart(id, label, data) {
        new Chart(document.getElementById(id), {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: label,
              data: data,
              borderWidth: 2
            }]
          }
        });
      }

      makeChart(`z${idx}Power`, "Power (W)", power);
      makeChart(`z${idx}Current`, "Current (A)", current);
      makeChart(`z${idx}Ldr`, "LDR", ldr);
      makeChart(`z${idx}Brightness`, "Brightness (%)", brightness);
    });
}

loadZone("Z1", 1);
loadZone("Z2", 2);
loadZone("Z3", 3);
loadZone("Z4", 4);
</script>

</body>
</html>

